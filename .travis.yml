language: python

python:
  - "3.5"

before_install:
  - sudo apt-get update
  - sudo apt-get install autopoint intltool libibus-1.0-dev python3-gi

  # Try to re-activate virtualenv after installing python related packages.
  # See if this gets python-config for the virtuanenv environment
  - echo $VIRTUAL_ENV
  - virtualenv $VIRTUAL_ENV
  - ls -l $VIRTUAL_ENV/bin

  # First install libcangjie
  - sudo apt-get install libsqlite3-dev
  - git clone git://github.com/Cangjians/libcangjie
  - cd libcangjie && git checkout 1.x && ./autogen.sh --prefix=/usr && make && sudo make install && cd ..
  - git clean -dfx

  # Next install pycangjie
  - sudo apt-get install cython python3-dev
  - git clone git://github.com/Cangjians/pycangjie
  - cd pycangjie && git checkout 1.x && ./autogen.sh --prefix=$VIRTUAL_ENV && make && sudo make install && cd ..
  - git clean -dfx

  # try to reset virtualenv, see if it get pycangjie
  - virtualenv $VIRTUAL_ENV

  # manually adapt Debian/Ubuntu dist-packages policy for pycangjie
  #- >
  #  export PYTHONPATH=PYTHONPATH=$(python3 -c "import os; print(os.path.dirname(os.__file__))") &&
  #  sudo ln -s /usr/lib/python3.5/site-packages/cangjie $PYTHONPATH/site-packages/. &&
  #  ls -l $PYTHONPATH/site-packages

script:
  - ./autogen.sh --prefix=$VIRTUAL_ENV && make
  - make check && make distcheck
