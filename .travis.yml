language: python

python:
  - "3.2"

virtualenv:
  system_site_packages: true

before_install:
  - sudo apt-get update
  - sudo apt-get install autopoint intltool libibus-1.0-dev python3-gobject

  # First install libcangjie
  - sudo apt-get install libsqlite3-dev
  - git clone git://github.com/Cangjians/libcangjie
  - cd libcangjie && git checkout 1.x && ./autogen.sh --prefix=/usr && make && sudo make install && cd ..
  - git clean -dfx

  # Next install pycangjie
  - sudo apt-get install cython python3-dev
  - git clone git://github.com/Cangjians/pycangjie
  - cd pycangjie && git checkout 1.x && ./autogen.sh --prefix=/usr && make && sudo make install && cd ..
  - git clean -dfx

  # manually adapt Debian/Ubuntu dist-packages policy for pycangjie
  - >
    export PYTHONPATH=/usr/lib/python3.5 &&
    sudo mkdir -p $PYTHONPATH/dist-packages &&
    sudo ln -s $PYTHONPATH/site-packages/cangjie $PYTHONPATH/dist-packages/. &&
    ls -l $PYTHONPATH/site-packages &&
    ls -l $PYTHONPATH/dist-packages

script:
  - ./autogen.sh --prefix=/usr && make
  - make check && make distcheck
